<!DOCTYPE html>
<html lang="en">
<head>
  <title>게시판</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript">
  let number = 0;
  const search = () => {
	  let dropdown = document.getElementById("drop");
	  let droper = dropdown.options[dropdown.selectedIndex].value;
	  let search = $("#search").val();
	  
	  console.log(search);
	  console.log(droper);
	  let data12 = {"search":search,"droper":droper};
	  $.ajax({
		  url:"/searchBoard",
		  type:"post",
		  data:data12,
		  success:function(data) {
			let str ='<tr>' ;
			$.each(data, function(i) {
				if(data[i].imagefile == null) {
					str +="<td>" +((number*5)+(i+1)) +"</td><td>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}else {
				str +="<td>" + ((number*5)+(i+1)) +"</td><td>"+"<img src="+"/imagePath/"+data[i].imagefile+" width='40' height='40'/>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}
			});
			$("#go").html(str);
			  
		  }
	  });
	  	$.ajax({
		  url:"/searchAllBoard",
		  data:data12,
		  type:"post",
		  success:function(data1) {
			  let num = data1.length / 5;
			  let pag = "";
			  for(let i = 0 ;i < num; i++ ) {
				  pag += "<a href='javascript:searchPage("+(i+1)+");'>"+ (i+1) +"</a>";
			  }
			  console.log(pag);
			  $("#page").html(pag);
		  }
	  });
  }
    const searchPage = (j)=> {
	let dropdown = document.getElementById("drop");
	let droper = dropdown.options[dropdown.selectedIndex].value;
	let search = $("#search").val();
	  number = j-1;
	  let page = j;
	  let data12 = {"page":page,"search":search,"droper":droper};
	  $.ajax({
		  url:"/searchBoardpage",
		  type:"post",
		  data:data12,
		  success:function(data) {
			let str ='<tr>' ;
			$.each(data, function(i) {
				if(data[i].imagefile == null) {
					str +="<td>" + ((number*5)+(i+1)) +"</td><td>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}else {
				str +="<td>" + ((number*5)+(i+1)) +"</td><td>"+"<img src="+"/imagePath/"+data[i].imagefile+" width='45' height='45'/>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}
				
			});
			$("#go").html(str);
		  }
	  });
	  
  }
  const chagePage = (j)=> {
	  number = j-1;
	  let page = j;
	  let data1 = {"page":page};
	  $.ajax({
		  url:"/changePage",
		  type:"post",
		  data:data1,
		  success:function(data) {
			let str ='<tr>' ;
			$.each(data, function(i) {
				if(data[i].imagefile == null) {
					str +="<td>" + ((number*5)+(i+1)) +"</td><td>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}else {
				str +="<td>" + ((number*5)+(i+1)) +"</td><td>"+"<img src="+"/imagePath/"+data[i].imagefile+" width='45' height='45'/>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}
				
			});
			$("#go").html(str);
		  }
	  });
	  
  }
  $(document).ready(function() {
	  $.ajax({
		  url:"/getBoardList",
		  type:"post",
		  success:function(data) {
			let str ='<tr>' ;
			$.each(data, function(i) {
				if(data[i].imagefile == null) {
					str +="<td>" +((number*5)+(i+1)) +"</td><td>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}else {
				str +="<td>" + ((number*5)+(i+1)) +"</td><td>"+"<img src="+"/imagePath/"+data[i].imagefile+" width='40' height='40'/>"
				+"</td><td>"+data[i].title+"</td><td>"+data[i].text+"</td><td>"+data[i].account_id+ "</td>" +
				"<td><input type='button' class='btn btn-primary' value='삭제' onclick="+"location.href='/deleteBoard/?board_no="+data[i].board_no+"'"+"></input></td>"
				+ "<td><input type='button' class='btn btn-primary' value='수정' onclick"+"=location.href='/alterBoard/?board_no="+data[i].board_no+"'"+"></input></td>";
				str += '</tr>';
				}
			});
			$("#go").html(str);
		  }
	  });
	  
	 $.ajax({
		  url:"/getAllBoardList",
		  type:"post",
		  success:function(data1) {
			  let num = data1.length / 5;
			  let pag = "";
			  for(let i = 0 ;i < num; i++ ) {
				  pag += "<a href='javascript:chagePage("+(i+1)+");'>"+ (i+1) +"</a>";
			  }
			  console.log(pag);
			  $("#page").html(pag);
		  }
	  });
  });
  
  
  
  </script>
</head>
<body>

<div class="container">
 <h1><p class="text-center">게시판</p></h1> <input class="btn btn-primary" type="button" value="게시글 작성" th:onclick="|location.href='@{/boardPage'}|"/>
 <input class="btn btn-primary" type="button" value="로그아웃" th:onclick="|location.href='@{/logout'}|"/>
 <input class="btn btn-primary" th:if="${id == 'admin'} "type="button" value="회원 목록" th:onclick="|location.href='@{/getUser'}|"/>
 <select id="drop">
 	<option value="title || text || account_id" selected>전체</option>
 	<option value="title">제목</option>
 	<option value="text">내용</option>
 	<option value="account_id">작성자</option>
 </select>
 <input type="text" placeholder="검색" id="search"/> <input type="button" class="btn btn-primary" value="검색" onclick="search()"></input>
 <table class="table table-striped">
	<tr>
		<th>게시글 번호</th>
		<th>사진</th>
		<th>제목</th>
		<th>내용</th>
		<th>작성자</th>
		<th>삭제</th>
		<th>수정</th>
	</tr>
	<tbody id="go">
		
	</tbody>																							
</table>
<p id = "page"> </p>
</div>

</body>
</html>